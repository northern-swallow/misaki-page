[{"content":"1. 项目架构图 1.1 一些概念 什么是服务器\n硬件: 一台配置高的电脑 软件: 电脑必须有一个能够解析http协议的软件 常见的Web服务器\ntomcat服务器\napache组织产品, 开源的免费服务器 weblogic 服务器\nbea公司, 收费的服务器 不交费, 访问量受限制 IIS服务器\nInternet Information Server\n微软公司主推的服务器\nnginx\n小巧且高效的HTTP服务器 也可以做一个高效的负载均衡反向代理 邮件服务器 pop3/smtp/imap 1.2 项目架构 客户端 网络架构: b/s 必须使用http协议 c/s 协议可以随意选择 Qt -\u0026gt; http 服务器 Nginx 能处理静态请求 -\u0026gt; html, jpg 动态请求无法处理 服务器集群之后, 每台服务器上部署的内容必须相同 fastCGI 帮助服务器处理动态请求 反向代理服务器 客户端并不能直接访问web服务器, 直接访问到的是反向代理服务器 客户端静请求发送给反向代理服务器, 反向代理将客户端请求转发给web服务器 关系型数据库 存储文件属性信息 用户的属性信息 redis - 非关系型数据库 (内存数据库) 作用提出程序效率 存储是服务器经常要从关系型数据中读取的数据 FASTDFS - 分布式文件系统 存储文件内容 供用户下载 2. 分布式文件系统 2.1 传统文件系统 传统的文件系统格式: ntfs / fat32 / ext3 / ext4 可以被挂载和卸载 ###2.2 分布式文件系统\n文件系统的全部, 不在同一台主机上，而是在很多台主机上，多个分散的文件系统组合在一起，形成了一个完整的文件系统。\n分布式文件系统:\n需要有网络 多台主机 不需要在同一地点 需要管理者 编写应用层的管理程序 不需要编写 3. FastDFS 3.1 fastDFS介绍 fastDFS概述\n是用c语言编写的一款开源的分布式文件系统。 余庆 - 淘宝的架构师 为互联网量身定制，充分考虑了冗余备份、负载均衡、线性扩容等机制，注重高可用、高性能等指标 冗余备份: 纵向扩容 线性扩容: 横向扩容 可以很容易搭建一套高性能的文件服务器集群提供文件==上传、下载==等服务。 图床 网盘 fastDFS框架中的三个角色\n追踪器 ( Tracker ) - 管理者 - 守护进程 管理存储节点 存储节点 - storage - 守护进程 存储节点是有多个的 客户端 - 不是守护进程, 这是程序猿编写的程序 文件上传 文件下载 fastDFS三个角色之间的关系\n追踪器 最先启动追踪器 存储节点 第二个启动的角色 存储节点启动之后, 会单独开一个线程 汇报当前存储节点的容量, 和剩余容量 汇报数据的同步情况 汇报数据被下载的次数 客户端 最后启动 上传 连接追踪器, 询问存储节点的信息 我要上传1G的文件, 询问那个存储节点有足够的容量 追踪器查询, 得到结果 追踪器将查到的存储节点的IP+端口发送给客户端 通过得到IP和端口连接存储节点 将文件内容发送给存储节点 下载 连接追踪器, 询问存储节点的信息 问一下, 要下载的文件在哪一个存储节点 追踪器查询, 得到结果 追踪器将查到的存储节点的IP+端口发送给客户端 通过得到IP和端口连接存储节点 下载文件 fastDFS集群 - （了解即可）\n追踪器集群 为什么集群？ 避免单点故障 多个Tracker如何工作？ 轮询工作 如何实现集群？ 修改配置文件 存储节点集群 fastDFS管理存储节点的方式？ 通过分组的方式完成的 集群方式（扩容方式） 横向扩容 - 增加容量 添加一台新的主机 -\u0026gt; 容量增加了 假设当前有两个组: group1, group2 需要添加一个新的分组 -\u0026gt; group3 新主机属于第三组 不同组的主机之间不需要通信 纵向扩容 - 数据备份 假设当前有两个组: group1, group2 将新的主机放到现有的组中 每个组的主机数量从1 -\u0026gt; N 这n台主机的关系就是相互备份的关系 同一个组中的主机需要通信 每组的容量 == 容量最小的这台主机 如何实现? 通过修改配置文件可实现 3.2 fastDFS安装 fastDFS安装\nlibfastcommon-1.36.zip fastdfs的基础库包 unzip xxx.zip ./make.sh ./make.sh install fastdfs-5.10.tar.gz tar zxvf xxx.tar.gz ./make.sh ./make.sh install 测试\n1 2 3 #fastDFS安装的所有的可执行程序: /usr/bin/fdfs_* fdfs_test 3.3 fastDFS配置文件 配置文件默认位置: /etc/fdfs\nclient.conf.sample storage.conf.sample storage_ids.conf.sample tracker.conf.sample\ntracker 配置文件\n1 2 3 4 5 6 7 # 将追踪器和部署的主机的IP地址进程绑定, 也可以不指定 # 如果不指定, 会自动绑定当前主机IP, 如果是云服务器建议不要写 bind_addr=192.168.247.135 # 追踪器监听的端口 port=22122 # 追踪器存储日志信息的目录, xxx.pid文件, 必须是一个存在的目录 base_path=/home/yuqing/fastdfs storage 配置文件\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # 当前存储节点对应的主机属于哪一个组 group_name=group1 # 当前存储节点和所应该的主机进行IP地址的绑定, 如果不写, 有fastdfs自动绑定 bind_addr= # 存储节点绑定的端口 port=23000 # 存储节点写log日志的路径 base_path=/home/yuqing/fastdfs # 存储节点提供的存储文件的路径个数 store_path_count=2 # 具体的存储路径 store_path0=/home/yuqing/fastdfs store_path1=/home/yuqing/fastdfs1 # 追踪器的地址信息 tracker_server=192.168.247.135:22122 tracker_server=192.168.247.136:22122 客户端配置文件\n1 2 3 4 5 6 7 8 9 # 客户端写log日志的目录 # 该路径必须存在 # 当前的用户对于该路径中的文件有读写权限 # 当前用户robin # 指定的路径属于root base_path=/home/yuqing/fastdfs # 要连接的追踪器的地址信息 tracker_server=192.168.247.135:22122 tracker_server=192.168.247.136:22122 安装fastDFS安装包 3.4 fastDFS的启动 第一个启动追踪器 - 守护进程\n1 2 3 4 5 6 7 # 启动程序在 /usr/bin/fdfs_* # 启动 fdfs_trackerd 追踪器的配置文件(/etc/fdfs/tracker.conf) # 关闭 fdfs_trackerd 追踪器的配置文件(/etc/fdfs/tracker.conf) stop # 重启 fdfs_trackerd 追踪器的配置文件(/etc/fdfs/tracker.conf) restart 第二个启动存储节点 - 守护进程\n1 2 3 4 5 6 # 启动 fdfs_storaged 存储节点的配置文件(/etc/fdfs/stroga.conf) # 关闭 fdfs_storaged 存储节点的配置文件(/etc/fdfs/stroga.conf) stop # 重启 fdfs_storaged 存储节点的配置文件(/etc/fdfs/stroga.conf) restart 最后启动客户端 - 普通进程\n1 2 3 4 5 # 上传 fdfs_upload_file 客户端的配置文件(/etc/fdfs/client.conf) 要上传的文件 # 得到的结果字符串: group1/M00/00/00/wKj3h1vC-PuAJ09iAAAHT1YnUNE31352.c # 下载 fdfs_download_file 客户端的配置文件(/etc/fdfs/client.conf) 上传成功之后得到的字符串(fileID) fastDFS状态检测\n命令\n1 fdfs_monitor /etc/fdfs/client.conf Storage Server的7种状态\nhttps://blog.csdn.net/u014723529/article/details/46048411\n1 2 3 4 5 6 7 # FDFS_STORAGE_STATUS：INIT :初始化，尚未得到同步已有数据的源服务器 # FDFS_STORAGE_STATUS：WAIT_SYNC :等待同步，已得到同步已有数据的源服务器 # FDFS_STORAGE_STATUS：SYNCING :同步中 # FDFS_STORAGE_STATUS：DELETED :已删除，该服务器从本组中摘除 # FDFS_STORAGE_STATUS：OFFLINE :离线 # FDFS_STORAGE_STATUS：ONLINE :在线，尚不能提供服务 # FDFS_STORAGE_STATUS：ACTIVE :在线，可以提供服务 3.5 对file_id的解释 ![1527004617787](D:/BaiduNetdiskDownload/C++就业班全套课程（视频+讲义+代码+软件）/12.项目2：fastDFS 分布式文件系统/day01-fastDFS/day01-fastDFS/01-课程资料/day01-笔记/1527004617787.png)\ngroup1 文件上传到了存储节点的哪一个组 如果有多个组这个组名可变的 M00 - 虚拟目录 和存储节点的配置项有映射 store_path0=/home/yuqing/fastdfs/data -\u0026gt; M00 store_path1=/home/yuqing/fastdfs1/data -\u0026gt; M01 00/00 实际的路径 可变的 wKhS_VlrEfOAdIZyAAAJTOwCGr43848.md 文件名包含的信息 采用Base64编码 包含的字段包括\n源storage server Ip 地址\n文件创建时间\n文件大小\n文件CRC32效验码\n循环冗余校验 随机数\n4. 上传下载代码实现 使用多进程方式实现\nexec函数族函数\nexecl execlp 父进程\n子进程 -\u0026gt; 执行\nexeclp(\u0026ldquo;fdfs_upload_file\u0026rdquo; , \u0026ldquo;xx\u0026rdquo;, arg, NULL), 有结果输出, 输出到终端\n不让它写到终端 -\u0026gt; 重定向dup2(old, new) old-\u0026gt; 标准输出 new -\u0026gt; 管道的写端 文件描述符 数据块读到内存 -\u0026gt; 子进程 数据最终要给到父进程 pipe -\u0026gt; 读端, 写端 在子进程创建之前创建就行了 父进程\n读管道 -\u0026gt; 内存 内存数据写数据库 使用fastDFS API实现\n5. 源码安装 - 回顾 安装流程:\n以下文件, 里边有安装步骤 readme readme.md INSTALL 找 可执行文件 configure 执行这个可执行文件 检测安装环境 生成 makefile 执行make命令 编译源代码 生成了动态库 静态库 可执行程序 安装 make install (需要管理员权限) 将第三步生成的动态库/动态库/可执行程序拷贝到对应的系统目录 ","date":"2025-03-04T22:03:16+08:00","permalink":"https://northern-swallow.github.io/misaki-page/p/fastdfs_day1/","title":"Fastdfs_day1"},{"content":"​\t现在是2025年2月24日……让我看下时间，23点51分，对于大多数碌碌的人群来说是折磨人的周一的结束，又对部分人来说是狂欢的一天，也许……是失落的一天。哦对了朋友，我忘记说了，我已经好久没有写过日记了，久到我都忘了上一次写是在什么时候。对于我这样的人，在这样的日子突然心血来潮想写份日记，原因你大概也能想到点了。我是后一批人呢……\n​\t是的，我考研失败了，一个我很早就做过准备的糟糕的结果。对于人们而言，未能切身感受的事情，无论发挥多么天马行空的想象都不及其本身的万分之一。所以我现在需要尽可能坦然地描述这件事情，因为这确实会让人好受点，也许是这样能些许剥离人为赋予的意义与这件事情本身之间的联系。我不清楚，不过值得一试。\n​\t到这里才305个字（好少，作为infp确实措辞措的比较久hhhhh），所以我们展开来聊聊？聊点什么呢……想来我很好奇这篇日记被你看到是什么时候又是因何而看到，是因为考研也失败了吗，又或者碰到了什么难以承受的磨难，又或者你是作为若干年后的我，重新翻出了这篇日记。不管是因何原因，如果你正感觉被悲伤所吞没，也许你可以试试闭上眼睛，此时还有些难过的我能和你做个伴。我肯定不知道你为什么难过，因为我是过去的幽灵（吓人），也不能确切地感受你有多难过，这太不尊重你了。但如果你感觉有点坚持不住的话，那一定是非常非常巨大的难过。\n​\t既然聊不了关于你的事情，那请允许我剖析下我此刻的心情，以我现在浅薄的三观。\n​\t……\n​\t一静下来，还是有点难过的。坦白来讲，选择考研这一条路对于我而言有很多条理由：我对深度学习的课题是有所兴趣，如果有机会做进一步的课题是很好的事情；我不满意自己的高考想要去更好的院校；当然我也在逃避就业。考研的失败带给我的不仅是备考付出的努力被否定的难过，其实也有对就业的恐惧。因为我现在不仅得准备就业，还得准备毕业论文（该死的ztl），压力真有点大。所以，我其实并不是惧怕和难过考研失败这件事，于我而言，它只是我备考一年所得到的一个结果。我所惧怕和难过的是它被人们赋予的意义：我不够努力；我是个loser；我不得不面对卷的要死的就业市场，我都不知道我卷不卷的过别人；我毕业论文还没啥头绪，好忙好忙。但是如果我拿到了安稳的offer，已经完成了毕业论文，我大概也就没有那么大的情绪起伏了……当然，没有这么多如果。所以当务之急是把这两件事尽快解决，而考研失败……就让它成为一个未来也许能弥补的遗憾好啦。如此想来，心情好多了。不知对你是否有所帮助。如果你仍然觉得悲伤，那就让它存在吧，我们应当让其存在。\n​\n​\t后记：我想既然半夜写了这篇日记了，就让我适当宣泄下自己的情绪吧。我很想讲一讲我近两年一直不敢提起的事。对于我而言，大学的四年是人生中过的最快的四年，也是人生中最悲伤的四年。我在大一时得知我的爷爷得了肺癌，所以从那时起，我便开始做着离别的准备，而疫情还有两年才结束。因为疫情的间断影响加上在外上大学，其实我与爷爷在一年中见面的次数很少，对于我而言其实也在逃避他将离去（死去）的事实，或者说我仍希望于他的病情发展的很缓慢，所以还有好几年。但是很遗憾，2002年的国庆我收到了他去世的消息，而我困在了被疫情封锁的学校。许是未能亲手触摸确认，只有视频通话的最后一面使我对他的离去直至今日仍然恍惚。对他，我几乎没有回报，这是我心中最大遗憾。自从爷爷家附近工厂因水库的关系而被迫关闭导致村里没有年轻人后我记得我就没再在爷爷家过过夜。只有假期的匆匆几面，想来亏欠甚多。唯一令我骄傲的一点是我成功教会了我的外公使用pad，没有教爷爷是因为肺病折磨得他太过难受，现在想来，就连那时看我周末出去拍的青岛风景都是那么得艰难。我还记得他在病房跟病友说我很会读书呢……\n​\t相较于爷爷，外公的身体就爽朗的很，学起东西来也很快，只花了一个下午就上手了pad。然后他就老是拿着pad刷抖音，之前还调侃我们小孩玩手机上瘾，结果轮到他被外婆数落了。你看，这么健康的外公肯定还能陪我们好久好久，久到我工作稳定，久到我有自己的家庭，久到四世甚至五世同堂吧……我还记得，2003年2月19日，是我结束寒假返校日子，我刚收拾完行李箱就接到了母亲的电话，她只问我能不能回来，听到我有因疫情推迟的考试后便挂断了电话。如此反常的话语，和那颤抖的声音怎能不让人起疑，故，向父亲问询。车祸，发生在我的外公身上……真的很难说，天灾人祸都尝了个遍。那时， 离我的爷爷去世才4个月。而疫情……也在不久之后解禁。有太多的人留在了这场新冠。我不知道是否从那时起我的一部分就随着一起缺失，但是大学剩下的两年真的过的很无感，只有外公去世的那个学期让我报复性学习了一学期。在家里我尽量保持情绪平静，因为我想我们家需要有这么一个人……\n​\t之所以写辣么长的后记，我也不知道为啥，就是很想仔细地怀念他们。这周五就是外公去世两年了（为啥过农历搞不懂），也许是想借这个机会悼念下吧。不过最近情绪确实不稳定……\n​\t一看时间已经是次日2：20了，就当陪我聊了2个多小时，谢谢你愿意听完……\n","date":"2025-02-24T23:48:51+08:00","permalink":"https://northern-swallow.github.io/misaki-page/p/diary250224/","title":"Diary250224"}]